<!DOCTYPE html><html class="theme-next pisces use-motion" lang="zh-Hans"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css"><meta name="keywords" content="Contiki,RF,"><link rel="alternate" href="/atom.xml" title="Bovey's Blog" type="application/atom+xml"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2"><meta name="description" content="要先知道怎么工作的才好了解，移植。本文从main函数中的rf相关代码入手，顺藤摸瓜理清RF的相关操作和数据处理流程。"><meta name="keywords" content="Contiki,RF"><meta property="og:type" content="article"><meta property="og:title" content="Contiki RF底层代码分析"><meta property="og:url" content="https://xubovey.github.io/2016/10/25/161025-ContikiNetStack-RFAnalysis/index.html"><meta property="og:site_name" content="Bovey&#39;s Blog"><meta property="og:description" content="要先知道怎么工作的才好了解，移植。本文从main函数中的rf相关代码入手，顺藤摸瓜理清RF的相关操作和数据处理流程。"><meta property="og:locale" content="zh-Hans"><meta property="og:updated_time" content="2019-08-27T02:27:47.160Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Contiki RF底层代码分析"><meta name="twitter:description" content="要先知道怎么工作的才好了解，移植。本文从main函数中的rf相关代码入手，顺藤摸瓜理清RF的相关操作和数据处理流程。"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",sidebar:{position:"right",display:"always",offset:12,offset_float:12,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,tabs:!0,motion:!0,duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="https://xubovey.github.io/2016/10/25/161025-ContikiNetStack-RFAnalysis/"><title>Contiki RF底层代码分析 | Bovey's Blog</title></head><body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-right page-post-detail"><div class="headband"></div><header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Bovey's Blog</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">点滴</p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://xubovey.github.io/2016/10/25/161025-ContikiNetStack-RFAnalysis/"><span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="name" content="xu.bovey"><meta itemprop="description" content=""><meta itemprop="image" content="https://raw.githubusercontent.com/XuBovey/xubovey.github.io/source/blog_images/images/avatar.jpg"></span><span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Bovey's Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Contiki RF底层代码分析</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-25T16:30:12+00:00">2016-10-25</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Contiki/" itemprop="url" rel="index"><span itemprop="name">Contiki</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p>要先知道怎么工作的才好了解，移植。本文从main函数中的rf相关代码入手，顺藤摸瓜理清RF的相关操作和数据处理流程。</p><a id="more"></a><h1 id="1-main函数中的RF相关代码"><a href="#1-main函数中的RF相关代码" class="headerlink" title="1. main函数中的RF相关代码"></a>1. main函数中的RF相关代码</h1><p>为什么从main入手，因为这里有初始化等相关代码，基本可以顺藤摸瓜搞明白里面的问题所在。<br>参考文件：contiki/platform/srf06-cc26xx/contiki-main.c，其中main函数里与射频相关的代码只有两句：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netstack_init();</span><br><span class="line">set_rf_params();</span><br></pre></td></tr></table></figure><p></p><h1 id="2-set-rf-params函数"><a href="#2-set-rf-params函数" class="headerlink" title="2. set_rf_params函数"></a>2. set_rf_params函数</h1><p>这里先看<code>set_rf_params()</code>因为函数体就定义在main函数中。核心代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取设备地址，并取出16位小地址。</span></span><br><span class="line">ieee_addr_cpy_to(ext_addr, <span class="number">8</span>); </span><br><span class="line">short_addr = ext_addr[<span class="number">7</span>];</span><br><span class="line">short_addr |= ext_addr[<span class="number">6</span>] &lt;&lt; <span class="number">8</span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">//同样是地址配置，这里将地址copy给了linkaddr_node_addr.</span></span><br><span class="line"><span class="comment">/* Populate linkaddr_node_addr. Maintain endianness */</span></span><br><span class="line"><span class="built_in">memcpy</span>(&amp;linkaddr_node_addr, &amp;ext_addr[<span class="number">8</span> - LINKADDR_SIZE], LINKADDR_SIZE);</span><br><span class="line"></span><br><span class="line"><span class="comment">//这也是一些配置，问题是NETSTACK_RADIO.set_value是什么？</span></span><br><span class="line">NETSTACK_RADIO.set_value(RADIO_PARAM_PAN_ID, IEEE802154_PANID);</span><br><span class="line">NETSTACK_RADIO.set_value(RADIO_PARAM_16BIT_ADDR, short_addr);</span><br><span class="line">NETSTACK_RADIO.set_value(RADIO_PARAM_CHANNEL, RF_CORE_CHANNEL);</span><br><span class="line">NETSTACK_RADIO.set_object(RADIO_PARAM_64BIT_ADDR, ext_addr, <span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">NETSTACK_RADIO.get_value(RADIO_PARAM_CHANNEL, &amp;val);</span><br></pre></td></tr></table></figure><p></p><p>注释中可以看到，这段代码引出了<code>NETSTACK_RADIO.set_value</code>函数，<code>NETSTACK_RADIO</code>应该是个包含有函数指针的结构体。<br>在contiki/core/net/netstack.h文件中找到如下宏定义：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NETSTACK_RADIO NETSTACK_CONF_RADIO</span></span><br></pre></td></tr></table></figure><p></p><p>继续在contiki/platform/srf06-cc26xx/contiki-conf.h中找到相关代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NETSTACK_CONF_RADIO        ieee_mode_driver <span class="comment">//这就是我们要找的了。</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> RF_CORE_CONF_CHANNEL</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RF_CORE_CONF_CHANNEL                     25</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NULLRDC_CONF_802154_AUTOACK_HW            1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> NULLRDC_CONF_SEND_802154_ACK              0</span></span><br></pre></td></tr></table></figure><p></p><p>嗯，好了把main函数中的set_value相关代码展开如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ieee_mode_driver.set_value(RADIO_PARAM_PAN_ID, IEEE802154_PANID);</span><br><span class="line">ieee_mode_driver.set_value(RADIO_PARAM_16BIT_ADDR, short_addr);</span><br><span class="line">ieee_mode_driver.set_value(RADIO_PARAM_CHANNEL, RF_CORE_CHANNEL);</span><br><span class="line">ieee_mode_driver.set_object(RADIO_PARAM_64BIT_ADDR, ext_addr, <span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">ieee_mode_driver.get_value(RADIO_PARAM_CHANNEL, &amp;val);</span><br></pre></td></tr></table></figure><p></p><p>找ieee-mode_driver，在contiki/cpu/cc26xx-cc13xx/rf-core/ieee-mode.c文件中找到该变量。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">radio_driver</span> <span class="title">ieee_mode_driver</span> = &#123;</span></span><br><span class="line">  init,             <span class="comment">//完成参数初始化，中断配置，启动rf_core_process进程</span></span><br><span class="line">  prepare,          <span class="comment">//发送准备，将数据拷贝到tx_buf缓冲区</span></span><br><span class="line">  transmit,         <span class="comment">//完成数据发送</span></span><br><span class="line">  send,             <span class="comment">//调用prepare和transmit，完成发送</span></span><br><span class="line">  read_frame,       <span class="comment">//将当前接收缓冲区数据拷贝到用户缓冲区</span></span><br><span class="line">  channel_clear,    <span class="comment">//判断当前通道是否有被其它设备使用</span></span><br><span class="line">  receiving_packet, <span class="comment">//检查CAA中的RF_CMD_CCA_REQ_CCA_SYNC_BUSY是否为1，判断有接收包</span></span><br><span class="line">  pending_packet,   <span class="comment">//遍历RF接收缓冲区链表，如果有未处理数据调用process_poll(&amp;rf_core_process)触发rf_core_process进程</span></span><br><span class="line">  on,               <span class="comment">//完成一些准备工作后，调用rx_on()-&gt;最终调用rf_cmd_ieee_rx()函数</span></span><br><span class="line">  off,              <span class="comment">//等待发送完成后调用rx_off();和rf_core_power_down();关闭rf接口</span></span><br><span class="line">  get_value,        <span class="comment">//读取单个RF配置参数，这些配置在init_rf_params函数（init函数调用）中被赋值</span></span><br><span class="line">  set_value,        <span class="comment">//单个RF参数设置</span></span><br><span class="line">  get_object,       <span class="comment">//单个参数读取RADIO_PARAM_64BIT_ADDR或RADIO_PARAM_LAST_PACKET_TIMESTAMP参数</span></span><br><span class="line">  set_object,       <span class="comment">//单个参数设置</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>经过查看set_value，set_object函数，发现这些操作都是在进行一些参数的配置。至此不必继续分析。只是ieee-mode中有些内部函数可以做简单说明：</p><ul><li>static uint8_t rf_is_on(void) 判定RF是否打开，1:处于接收模式，0：其他模式</li><li>static uint8_t transmitting(void) 判断是否处于发送状态，1：发送，0：其他</li><li>static uint8_t get_cca_info(void) 获取CAA信息</li><li>static radio_value_t get_rssi(void) 获取当前信号强度，单位dBm</li><li>static radio_value_t get_tx_power(void) 获取发送功率配置值，单位dBm</li><li>static void set_tx_power(radio_value_t power) 配置发送功率值，单位dBm</li><li>static uint8_t rf_radio_setup() 执行CMD_RADIO_SETUP命令完成参数配置</li><li>static uint8_t rf_cmd_ieee_rx() 配置RF为IEEE802.15.4 RX模式，即：用将cmd_ieee_rx_buf的内容完成RF配置</li><li>static void init_rx_buffers(void) 接收缓冲区初始化为循环链表</li><li>static void init_rf_params(void) 完成cmd_ieee_rx_buf参数设置</li><li>static int rx_on(void) 执行rf_cmd_ieee_rx();打开Rx</li><li>static int rx_off(void) 给RF内核发送CMD_ABORT命令关闭RF</li><li>static uint8_t request(void) LPM_MODULE(cc26xx_rf_lpm_module, request, NULL, NULL, LPM_DOMAIN_NONE);</li><li>static void soft_off(void) 给RF内核发送CMD_ABORT命令关闭RF</li><li>static uint8_t soft_on(void) 调用rx_on函数打开RF</li><li>static uint32_t calc_last_packet_timestamp(uint32_t rat_timestamp) 计算时间戳，用于流控</li></ul><h1 id="3-netstack-init函数"><a href="#3-netstack-init函数" class="headerlink" title="3 netstack_init函数"></a>3 netstack_init函数</h1><p>netstack_init函数位于contiki/core/net/netstack.c中，函数体并注释展开后的代码如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span></span><br><span class="line">netstack_init(<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">  NETSTACK_RADIO.init();   <span class="comment">// ieee_mode_driver.init();  // 网络的物理层</span></span><br><span class="line">  NETSTACK_RDC.init();     <span class="comment">// contikimac_driver.init(); // 网络的RDC层</span></span><br><span class="line">  NETSTACK_LLSEC.init();   <span class="comment">// nullsec_driver.init();    // 网络链路层</span></span><br><span class="line">  NETSTACK_MAC.init();     <span class="comment">// csma_driver.init();       // MAC层</span></span><br><span class="line">  NETSTACK_NETWORK.init(); <span class="comment">// rime_driver.init();       // 网络层</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>其中第一个分析如下，其它几个为协议栈上的函数暂不分析，分析协议栈的时候再另起新篇吧。</p><h1 id="4-ieee-mode-driver-init"><a href="#4-ieee-mode-driver-init" class="headerlink" title="4 ieee_mode_driver.init"></a>4 ieee_mode_driver.init</h1><p>这里调用的是init函数，函数内容：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*---------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span></span><br><span class="line">init(<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">  lpm_register_module(&amp;cc26xx_rf_lpm_module);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//调用函数HWREG(PRCM_BASE + PRCM_O_RFCMODESEL) = PRCM_RFCMODESEL_CURR_MODE5;</span></span><br><span class="line">  <span class="comment">//模式选择</span></span><br><span class="line">  <span class="comment">//这里出现的PRCM相关的宏定义位于Contiki/cpu/cc26xx-cc13xx/lib/cc26xxware/inc/hw-prcm.h,用find没找到。</span></span><br><span class="line">  rf_core_set_modesel();  </span><br><span class="line"> </span><br><span class="line">  <span class="comment">/* Initialise RX buffers */</span></span><br><span class="line">  <span class="comment">//初始化接收缓冲区，buf_0~3为4个缓冲区，构成循环链表</span></span><br><span class="line">  <span class="built_in">memset</span>(rx_buf_0, <span class="number">0</span>, RX_BUF_SIZE);</span><br><span class="line">  <span class="built_in">memset</span>(rx_buf_1, <span class="number">0</span>, RX_BUF_SIZE);</span><br><span class="line">  <span class="built_in">memset</span>(rx_buf_2, <span class="number">0</span>, RX_BUF_SIZE);</span><br><span class="line">  <span class="built_in">memset</span>(rx_buf_3, <span class="number">0</span>, RX_BUF_SIZE);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Set of RF Core data queue. Circular buffer, no last entry */</span></span><br><span class="line">  rx_data_queue.pCurrEntry = rx_buf_0;</span><br><span class="line"></span><br><span class="line">  rx_data_queue.pLastEntry = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Initialize current read pointer to first element (used in ISR) */</span></span><br><span class="line">  <span class="comment">//ISR中会对rx_read_entry进行处理。</span></span><br><span class="line">  rx_read_entry = rx_buf_0;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Populate the RF parameters data structure with default values */</span></span><br><span class="line">  <span class="comment">//RF相关参数初始化，例如：CRC、ack等。</span></span><br><span class="line">  init_rf_params();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//on()函数中做了很多事情：时钟的配置使能，还调用了函数init_rx_buffers();rf_core_setup_interrupts(poll_mode);rf_core_boot()；rf_radio_setup()；rx_on()；等。</span></span><br><span class="line">  <span class="keyword">if</span>(on() != RF_CORE_CMD_OK) &#123;</span><br><span class="line">    PRINTF(<span class="string">"init: on() failed\n"</span>);</span><br><span class="line">    <span class="keyword">return</span> RF_CORE_CMD_ERROR;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ENERGEST_ON(ENERGEST_TYPE_LISTEN);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//mode_ieee包含了两个函数soft_off和soft_on，将其配置给primary_mode变量。</span></span><br><span class="line">  rf_core_primary_mode_register(&amp;mode_ieee);</span><br><span class="line"></span><br><span class="line">  check_rat_overflow(<span class="literal">true</span>);</span><br><span class="line">  <span class="comment">//溢出监视。</span></span><br><span class="line">  ctimer_set(&amp;rat_overflow_timer, RAT_OVERFLOW_PERIOD_SECONDS * CLOCK_SECOND / <span class="number">2</span>,</span><br><span class="line">             handle_rat_overflow, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//启动rf_core_process进程。</span></span><br><span class="line">  process_start(&amp;rf_core_process, <span class="literal">NULL</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>根据分析，init函数完成了接收缓冲区的清零操作，调用<code>init_rf_params();</code>函数完成参数初始化，调用on函数打开RF并配置了中断函数入口地址，回调函数定时器配置ctimer_set，最后完成启动进程rf_core_process。</p><h1 id="5-rf-core-process"><a href="#5-rf-core-process" class="headerlink" title="5. rf_core_process"></a>5. rf_core_process</h1><p>该进程定义于contiki/cpu/cc26xx-cc13xx/rf-core/rf_core.c文件中。函数体：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">PROCESS_THREAD(rf_core_process, ev, data)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">int</span> len;</span><br><span class="line"></span><br><span class="line">  PROCESS_BEGIN();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">    PROCESS_YIELD_UNTIL(ev == PROCESS_EVENT_POLL);</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      watchdog_periodic();</span><br><span class="line">      packetbuf_clear();</span><br><span class="line">      len = NETSTACK_RADIO.read(packetbuf_dataptr(), PACKETBUF_SIZE);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(len &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        packetbuf_set_datalen(len);</span><br><span class="line"></span><br><span class="line">        NETSTACK_RDC.input();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">while</span>(len &gt; <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  PROCESS_END();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>该进程做的事情很简单，当PROCESS_EVENT_POLL事件发生的时候，调用<code>NETSTACK_RADIO.read</code>函数读取接收缓冲区数据，并调用<code>NETSTACK_RDC.input</code>函数通知上层协议。如果不需要协议层的支持，在这个process中调用自定义函数触发数据处理进程即可。PROCESS_EVENT_POLL事件是执行process_poll函数时触发的。上文分析在init函数中调用的on函数里调用了<code>rf_core_setup_interrupts(poll_mode);</code>最终执行如下代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HWREG(RFC_DBELL_NONBUF_BASE + RFC_DBELL_O_RFCPEIEN) = ENABLED_IRQS_POLL_MODE;</span><br></pre></td></tr></table></figure><p></p><p>看来这里只定义了poll_mode模式，还以为在中断里调用了poll呢，那么就搜索吧，执行<code>find</code>命令：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">user<span class="meta">@instant</span>-<span class="string">contiki:</span>~/contiki$ find -name <span class="string">"*.c"</span> | xargs grep  <span class="string">"process_poll(&amp;rf_core_process)"</span></span><br><span class="line">.<span class="regexp">/cpu/</span>cc26xx-cc13xx<span class="regexp">/rf-core/</span>rf-core.<span class="string">c:</span>    process_poll(&amp;rf_core_process);</span><br><span class="line">.<span class="regexp">/cpu/</span>cc26xx-cc13xx<span class="regexp">/rf-core/</span>prop-mode.<span class="string">c:</span>      process_poll(&amp;rf_core_process);</span><br><span class="line">.<span class="regexp">/cpu/</span>cc26xx-cc13xx<span class="regexp">/rf-core/</span>ieee-mode.<span class="string">c:</span>        process_poll(&amp;rf_core_process);</span><br></pre></td></tr></table></figure><p></p><p>原来只是没找到,rf-core.c中是在函数<code>void cc26xx_rf_cpe0_isr(void)</code>中调用process_poll的，而这个函数正是中断函数。<br>ieee-mode.c中是在pending_packet函数中调用的，遍历接收缓冲区时，当存在缓冲区状态为DATA_ENTRY_STATUS_FINISHED时调用poll。触发数据接收。<br>prop-mode.c和ieee-mode.c是并列文件，其中的process_poll函数同样是在pending_start函数中调用的。</p><h1 id="6-自定义配置"><a href="#6-自定义配置" class="headerlink" title="6. 自定义配置"></a>6. 自定义配置</h1><p>如果想自定义配置一些参数、功能，需要对RF部分的参数有清除的掌握才行。而这些参数的定义在文件cpu/cc26xx-cc13xx/rf-core/api/ieee-cmd.h中。</p><h1 id="6-1-CMD-IEEE-RX命令参数"><a href="#6-1-CMD-IEEE-RX命令参数" class="headerlink" title="6.1 CMD_IEEE_RX命令参数"></a>6.1 CMD_IEEE_RX命令参数</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CMD_IEEE_RX                                             0x2801</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">RFC_STRUCT</span> <span class="title">rfc_CMD_IEEE_RX_s</span> &#123;</span></span><br><span class="line">   <span class="keyword">uint16_t</span> commandNo;                  <span class="comment">//!&lt;        The command ID number 0x2801</span></span><br><span class="line">   <span class="keyword">uint16_t</span> status;                     <span class="comment">//!&lt; \brief An integer telling the status of the command. This value is</span></span><br><span class="line">                                        <span class="comment">//!&lt;        updated by the radio CPU during operation and may be read by the</span></span><br><span class="line">                                        <span class="comment">//!&lt;        system CPU at any time.</span></span><br><span class="line">   rfc_radioOp_t *pNextOp;              <span class="comment">//!&lt;        Pointer to the next operation to run after this operation is done</span></span><br><span class="line">   <span class="keyword">ratmr_t</span> startTime;                   <span class="comment">//!&lt;        Absolute or relative start time (depending on the value of &lt;code&gt;startTrigger&lt;/code&gt;)</span></span><br><span class="line">   <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">      <span class="keyword">uint8_t</span> triggerType:<span class="number">4</span>;            <span class="comment">//!&lt;        The type of trigger</span></span><br><span class="line">      <span class="keyword">uint8_t</span> bEnaCmd:<span class="number">1</span>;                <span class="comment">//!&lt; \brief 0: No alternative trigger command&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: CMD_TRIGGER can be used as an alternative trigger</span></span><br><span class="line">      <span class="keyword">uint8_t</span> triggerNo:<span class="number">2</span>;              <span class="comment">//!&lt;        The trigger number of the CMD_TRIGGER command that triggers this action</span></span><br><span class="line">      <span class="keyword">uint8_t</span> pastTrig:<span class="number">1</span>;               <span class="comment">//!&lt; \brief 0: A trigger in the past is never triggered, or for start of commands, give an error&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: A trigger in the past is triggered as soon as possible</span></span><br><span class="line">   &#125; startTrigger;                      <span class="comment">//!&lt;        Identification of the trigger that starts the operation</span></span><br><span class="line">   <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">      <span class="keyword">uint8_t</span> rule:<span class="number">4</span>;                   <span class="comment">//!&lt;        Condition for running next command: Rule for how to proceed</span></span><br><span class="line">      <span class="keyword">uint8_t</span> nSkip:<span class="number">4</span>;                  <span class="comment">//!&lt;        Number of skips if the rule involves skipping</span></span><br><span class="line">   &#125; condition;</span><br><span class="line">   <span class="keyword">uint8_t</span> channel;                     <span class="comment">//!&lt; \brief Channel to tune to in the start of the operation&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        0: Use existing channel&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        11&amp;ndash;26: Use as IEEE 802.15.4 channel, i.e. frequency is (2405 + 5 &amp;times; (channel - 11)) MHz&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        60&amp;ndash;207: Frequency is  (2300 + channel) MHz&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        Others: &lt;i&gt;Reserved&lt;/i&gt;</span></span><br><span class="line">   <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">      <span class="keyword">uint8_t</span> bAutoFlushCrc:<span class="number">1</span>;          <span class="comment">//!&lt;        If 1, automatically remove packets with CRC error from Rx queue</span></span><br><span class="line">      <span class="keyword">uint8_t</span> bAutoFlushIgn:<span class="number">1</span>;          <span class="comment">//!&lt;        If 1, automatically remove packets that can be ignored according to frame filtering from Rx queue</span></span><br><span class="line">      <span class="keyword">uint8_t</span> bIncludePhyHdr:<span class="number">1</span>;         <span class="comment">//!&lt;        If 1, include the received PHY header field in the stored packet; otherwise discard it</span></span><br><span class="line">      <span class="keyword">uint8_t</span> bIncludeCrc:<span class="number">1</span>;            <span class="comment">//!&lt;        If 1, include the received CRC field in the stored packet; otherwise discard it</span></span><br><span class="line">      <span class="keyword">uint8_t</span> bAppendRssi:<span class="number">1</span>;            <span class="comment">//!&lt;        If 1, append an RSSI byte to the packet in the Rx queue</span></span><br><span class="line">      <span class="keyword">uint8_t</span> bAppendCorrCrc:<span class="number">1</span>;         <span class="comment">//!&lt;        If 1, append a correlation value and CRC result byte to the packet in the Rx queue</span></span><br><span class="line">      <span class="keyword">uint8_t</span> bAppendSrcInd:<span class="number">1</span>;          <span class="comment">//!&lt;        If 1, append an index from the source matching algorithm</span></span><br><span class="line">      <span class="keyword">uint8_t</span> bAppendTimestamp:<span class="number">1</span>;       <span class="comment">//!&lt;        If 1, append a timestamp to the packet in the Rx queue</span></span><br><span class="line">   &#125; rxConfig;</span><br><span class="line">   dataQueue_t* pRxQ;                   <span class="comment">//!&lt;        Pointer to receive queue</span></span><br><span class="line">   rfc_ieeeRxOutput_t *pOutput;         <span class="comment">//!&lt;        Pointer to output structure (NULL: Do not store results)</span></span><br><span class="line">   <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">      <span class="keyword">uint16_t</span> frameFiltEn:<span class="number">1</span>;           <span class="comment">//!&lt; \brief 0: Disable frame filtering&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: Enable frame filtering</span></span><br><span class="line">      <span class="keyword">uint16_t</span> frameFiltStop:<span class="number">1</span>;         <span class="comment">//!&lt; \brief 0: Receive all packets to the end&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: Stop receiving frame once frame filtering has caused the frame to be rejected.</span></span><br><span class="line">      <span class="keyword">uint16_t</span> autoAckEn:<span class="number">1</span>;             <span class="comment">//!&lt; \brief 0: Disable auto ACK&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: Enable auto ACK.</span></span><br><span class="line">      <span class="keyword">uint16_t</span> slottedAckEn:<span class="number">1</span>;          <span class="comment">//!&lt; \brief 0: Non-slotted ACK&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: Slotted ACK.</span></span><br><span class="line">      <span class="keyword">uint16_t</span> autoPendEn:<span class="number">1</span>;            <span class="comment">//!&lt; \brief 0: Auto-pend disabled&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: Auto-pend enabled</span></span><br><span class="line">      <span class="keyword">uint16_t</span> defaultPend:<span class="number">1</span>;           <span class="comment">//!&lt;        The value of the pending data bit in auto ACK packets that are not subject to auto-pend</span></span><br><span class="line">      <span class="keyword">uint16_t</span> bPendDataReqOnly:<span class="number">1</span>;      <span class="comment">//!&lt; \brief 0: Use auto-pend for any packet&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: Use auto-pend for data request packets only</span></span><br><span class="line">      <span class="keyword">uint16_t</span> bPanCoord:<span class="number">1</span>;             <span class="comment">//!&lt; \brief 0: Device is not PAN coordinator&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: Device is PAN coordinator</span></span><br><span class="line">      <span class="keyword">uint16_t</span> maxFrameVersion:<span class="number">2</span>;       <span class="comment">//!&lt;        Reject frames where the frame version field in the FCF is greater than this value</span></span><br><span class="line">      <span class="keyword">uint16_t</span> fcfReservedMask:<span class="number">3</span>;       <span class="comment">//!&lt;        Value to be AND-ed with the reserved part of the FCF; frame rejected if result is non-zero</span></span><br><span class="line">      <span class="keyword">uint16_t</span> modifyFtFilter:<span class="number">2</span>;        <span class="comment">//!&lt; \brief Treatment of MSB of frame type field before frame-type filtering:&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        0: No modification&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: Invert MSB&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        2: Set MSB to 0&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        3: Set MSB to 1</span></span><br><span class="line">      <span class="keyword">uint16_t</span> bStrictLenFilter:<span class="number">1</span>;      <span class="comment">//!&lt; \brief 0: Accept acknowledgement frames of any length &gt;= 5&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: Accept only acknowledgement frames of length 5</span></span><br><span class="line">   &#125; frameFiltOpt;                      <span class="comment">//!&lt;        Frame filtering options</span></span><br><span class="line">   <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">      <span class="keyword">uint8_t</span> bAcceptFt0Beacon:<span class="number">1</span>;       <span class="comment">//!&lt; \brief Treatment of frames with frame type 000 (beacon):&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        0: Reject&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: Accept</span></span><br><span class="line">      <span class="keyword">uint8_t</span> bAcceptFt1Data:<span class="number">1</span>;         <span class="comment">//!&lt; \brief Treatment of frames with frame type 001 (data):&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        0: Reject&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: Accept</span></span><br><span class="line">      <span class="keyword">uint8_t</span> bAcceptFt2Ack:<span class="number">1</span>;          <span class="comment">//!&lt; \brief Treatment of frames with frame type 010 (ACK):&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        0: Reject, unless running ACK receive command&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: Always accept</span></span><br><span class="line">      <span class="keyword">uint8_t</span> bAcceptFt3MacCmd:<span class="number">1</span>;       <span class="comment">//!&lt; \brief Treatment of frames with frame type 011 (MAC command):&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        0: Reject&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: Accept</span></span><br><span class="line">      <span class="keyword">uint8_t</span> bAcceptFt4Reserved:<span class="number">1</span>;     <span class="comment">//!&lt; \brief Treatment of frames with frame type 100 (reserved):&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        0: Reject&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: Accept</span></span><br><span class="line">      <span class="keyword">uint8_t</span> bAcceptFt5Reserved:<span class="number">1</span>;     <span class="comment">//!&lt; \brief Treatment of frames with frame type 101 (reserved):&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        0: Reject&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: Accept</span></span><br><span class="line">      <span class="keyword">uint8_t</span> bAcceptFt6Reserved:<span class="number">1</span>;     <span class="comment">//!&lt; \brief Treatment of frames with frame type 110 (reserved):&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        0: Reject&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: Accept</span></span><br><span class="line">      <span class="keyword">uint8_t</span> bAcceptFt7Reserved:<span class="number">1</span>;     <span class="comment">//!&lt; \brief Treatment of frames with frame type 111 (reserved):&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        0: Reject&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: Accept</span></span><br><span class="line">   &#125; frameTypes;                        <span class="comment">//!&lt;        Frame types to receive in frame filtering</span></span><br><span class="line">   <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">      <span class="keyword">uint8_t</span> ccaEnEnergy:<span class="number">1</span>;            <span class="comment">//!&lt;        Enable energy scan as CCA source</span></span><br><span class="line">      <span class="keyword">uint8_t</span> ccaEnCorr:<span class="number">1</span>;              <span class="comment">//!&lt;        Enable correlator based carrier sense as CCA source</span></span><br><span class="line">      <span class="keyword">uint8_t</span> ccaEnSync:<span class="number">1</span>;              <span class="comment">//!&lt;        Enable sync found based carrier sense as CCA source</span></span><br><span class="line">      <span class="keyword">uint8_t</span> ccaCorrOp:<span class="number">1</span>;              <span class="comment">//!&lt; \brief Operator to use between energy based and correlator based CCA&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        0: Report busy channel if either ccaEnergy or ccaCorr are busy&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: Report busy channel if both ccaEnergy and ccaCorr are busy</span></span><br><span class="line">      <span class="keyword">uint8_t</span> ccaSyncOp:<span class="number">1</span>;              <span class="comment">//!&lt; \brief Operator to use between sync found based CCA and the others&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        0: Always report busy channel if ccaSync is busy&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: Always report idle channel if ccaSync is idle</span></span><br><span class="line">      <span class="keyword">uint8_t</span> ccaCorrThr:<span class="number">2</span>;             <span class="comment">//!&lt;        Threshold for number of correlation peaks in correlator based carrier sense</span></span><br><span class="line">   &#125; ccaOpt;                            <span class="comment">//!&lt;        CCA options</span></span><br><span class="line">   <span class="keyword">int8_t</span> ccaRssiThr;                   <span class="comment">//!&lt;        RSSI threshold for CCA</span></span><br><span class="line">   <span class="keyword">uint8_t</span> __dummy0;</span><br><span class="line">   <span class="keyword">uint8_t</span> numExtEntries;               <span class="comment">//!&lt;        Number of extended address entries</span></span><br><span class="line">   <span class="keyword">uint8_t</span> numShortEntries;             <span class="comment">//!&lt;        Number of short address entries</span></span><br><span class="line">   <span class="keyword">uint32_t</span>* pExtEntryList;             <span class="comment">//!&lt;        Pointer to list of extended address entries</span></span><br><span class="line">   rfc_shortAddrEntry_t *pShortEntryList;<span class="comment">//!&lt;        Pointer to list of short address entries</span></span><br><span class="line">   <span class="keyword">uint64_t</span> localExtAddr;               <span class="comment">//!&lt;        The extended address of the local device</span></span><br><span class="line">   <span class="keyword">uint16_t</span> localShortAddr;             <span class="comment">//!&lt;        The short address of the local device</span></span><br><span class="line">   <span class="keyword">uint16_t</span> localPanID;                 <span class="comment">//!&lt;        The PAN ID of the local device</span></span><br><span class="line">   <span class="keyword">uint16_t</span> __dummy1;</span><br><span class="line">   <span class="keyword">uint8_t</span> __dummy2;</span><br><span class="line">   <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">      <span class="keyword">uint8_t</span> triggerType:<span class="number">4</span>;            <span class="comment">//!&lt;        The type of trigger</span></span><br><span class="line">      <span class="keyword">uint8_t</span> bEnaCmd:<span class="number">1</span>;                <span class="comment">//!&lt; \brief 0: No alternative trigger command&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: CMD_TRIGGER can be used as an alternative trigger</span></span><br><span class="line">      <span class="keyword">uint8_t</span> triggerNo:<span class="number">2</span>;              <span class="comment">//!&lt;        The trigger number of the CMD_TRIGGER command that triggers this action</span></span><br><span class="line">      <span class="keyword">uint8_t</span> pastTrig:<span class="number">1</span>;               <span class="comment">//!&lt; \brief 0: A trigger in the past is never triggered, or for start of commands, give an error&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: A trigger in the past is triggered as soon as possible</span></span><br><span class="line">   &#125; endTrigger;                        <span class="comment">//!&lt;        Trigger that causes the device to end the Rx operation</span></span><br><span class="line">   <span class="keyword">ratmr_t</span> endTime;                     <span class="comment">//!&lt; \brief Time used together with &lt;code&gt;endTrigger&lt;/code&gt; that causes the device to end the Rx</span></span><br><span class="line">                                        <span class="comment">//!&lt;        operation</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>参数配置函数：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">init_rf_params(<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">  rfc_CMD_IEEE_RX_t *cmd = (rfc_CMD_IEEE_RX_t *)cmd_ieee_rx_buf;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(cmd_ieee_rx_buf, <span class="number">0x00</span>, RF_CMD_BUFFER_SIZE);</span><br><span class="line"></span><br><span class="line">  cmd-&gt;commandNo = CMD_IEEE_RX;</span><br><span class="line">  cmd-&gt;status = RF_CORE_RADIO_OP_STATUS_IDLE;</span><br><span class="line">  cmd-&gt;pNextOp = <span class="literal">NULL</span>;</span><br><span class="line">  cmd-&gt;startTime = <span class="number">0x00000000</span>;</span><br><span class="line">  cmd-&gt;startTrigger.triggerType = TRIG_NOW;</span><br><span class="line">  cmd-&gt;condition.rule = COND_NEVER;</span><br><span class="line">  cmd-&gt;channel = RF_CORE_CHANNEL;</span><br><span class="line"></span><br><span class="line">  cmd-&gt;rxConfig.bAutoFlushCrc = <span class="number">1</span>;</span><br><span class="line">  cmd-&gt;rxConfig.bAutoFlushIgn = <span class="number">0</span>;</span><br><span class="line">  cmd-&gt;rxConfig.bIncludePhyHdr = <span class="number">0</span>;</span><br><span class="line">  cmd-&gt;rxConfig.bIncludeCrc = <span class="number">1</span>;</span><br><span class="line">  cmd-&gt;rxConfig.bAppendRssi = <span class="number">1</span>;</span><br><span class="line">  cmd-&gt;rxConfig.bAppendCorrCrc = <span class="number">1</span>;</span><br><span class="line">  cmd-&gt;rxConfig.bAppendSrcInd = <span class="number">0</span>;</span><br><span class="line">  cmd-&gt;rxConfig.bAppendTimestamp = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  cmd-&gt;pRxQ = &amp;rx_data_queue;</span><br><span class="line">  cmd-&gt;pOutput = (rfc_ieeeRxOutput_t *)rf_stats;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> IEEE_MODE_PROMISCOUS</span></span><br><span class="line">  cmd-&gt;frameFiltOpt.frameFiltEn = <span class="number">0</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">  cmd-&gt;frameFiltOpt.frameFiltEn = <span class="number">1</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">  cmd-&gt;frameFiltOpt.frameFiltStop = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> IEEE_MODE_AUTOACK</span></span><br><span class="line">  cmd-&gt;frameFiltOpt.autoAckEn = <span class="number">1</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">  cmd-&gt;frameFiltOpt.autoAckEn = <span class="number">0</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">  cmd-&gt;frameFiltOpt.slottedAckEn = <span class="number">0</span>;</span><br><span class="line">  cmd-&gt;frameFiltOpt.autoPendEn = <span class="number">0</span>;</span><br><span class="line">  cmd-&gt;frameFiltOpt.defaultPend = <span class="number">0</span>;</span><br><span class="line">  cmd-&gt;frameFiltOpt.bPendDataReqOnly = <span class="number">0</span>;</span><br><span class="line">  cmd-&gt;frameFiltOpt.bPanCoord = <span class="number">0</span>;</span><br><span class="line">  cmd-&gt;frameFiltOpt.maxFrameVersion = <span class="number">2</span>;</span><br><span class="line">  cmd-&gt;frameFiltOpt.bStrictLenFilter = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Receive all frame types */</span></span><br><span class="line">  cmd-&gt;frameTypes.bAcceptFt0Beacon = <span class="number">1</span>;</span><br><span class="line">  cmd-&gt;frameTypes.bAcceptFt1Data = <span class="number">1</span>;</span><br><span class="line">  cmd-&gt;frameTypes.bAcceptFt2Ack = <span class="number">1</span>;</span><br><span class="line">  cmd-&gt;frameTypes.bAcceptFt3MacCmd = <span class="number">1</span>;</span><br><span class="line">  cmd-&gt;frameTypes.bAcceptFt4Reserved = <span class="number">1</span>;</span><br><span class="line">  cmd-&gt;frameTypes.bAcceptFt5Reserved = <span class="number">1</span>;</span><br><span class="line">  cmd-&gt;frameTypes.bAcceptFt6Reserved = <span class="number">1</span>;</span><br><span class="line">  cmd-&gt;frameTypes.bAcceptFt7Reserved = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Configure CCA settings */</span></span><br><span class="line">  cmd-&gt;ccaOpt.ccaEnEnergy = <span class="number">1</span>;</span><br><span class="line">  cmd-&gt;ccaOpt.ccaEnCorr = <span class="number">1</span>;</span><br><span class="line">  cmd-&gt;ccaOpt.ccaEnSync = <span class="number">1</span>;</span><br><span class="line">  cmd-&gt;ccaOpt.ccaCorrOp = <span class="number">1</span>;</span><br><span class="line">  cmd-&gt;ccaOpt.ccaSyncOp = <span class="number">0</span>;</span><br><span class="line">  cmd-&gt;ccaOpt.ccaCorrThr = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">  cmd-&gt;ccaRssiThr = IEEE_MODE_RSSI_THRESHOLD;</span><br><span class="line"></span><br><span class="line">  cmd-&gt;numExtEntries = <span class="number">0x00</span>;</span><br><span class="line">  cmd-&gt;numShortEntries = <span class="number">0x00</span>;</span><br><span class="line">  cmd-&gt;pExtEntryList = <span class="number">0</span>;</span><br><span class="line">  cmd-&gt;pShortEntryList = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  cmd-&gt;endTrigger.triggerType = TRIG_NEVER;</span><br><span class="line">  cmd-&gt;endTime = <span class="number">0x00000000</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* set address filter command */</span></span><br><span class="line">  filter_cmd.commandNo = CMD_IEEE_MOD_FILT;</span><br><span class="line">  <span class="built_in">memcpy</span>(&amp;filter_cmd.newFrameFiltOpt, &amp;cmd-&gt;frameFiltOpt, <span class="keyword">sizeof</span>(cmd-&gt;frameFiltOpt));</span><br><span class="line">  <span class="built_in">memcpy</span>(&amp;filter_cmd.newFrameTypes, &amp;cmd-&gt;frameTypes, <span class="keyword">sizeof</span>(cmd-&gt;frameTypes));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2 id="6-2-CMD-IEEE-TX命令参数"><a href="#6-2-CMD-IEEE-TX命令参数" class="headerlink" title="6.2 CMD_IEEE_TX命令参数"></a>6.2 CMD_IEEE_TX命令参数</h2><p>数据结构如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> CMD_IEEE_TX                                             0x2C01</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">RFC_STRUCT</span> <span class="title">rfc_CMD_IEEE_TX_s</span> &#123;</span></span><br><span class="line">   <span class="keyword">uint16_t</span> commandNo;                  <span class="comment">//!&lt;        The command ID number 0x2C01</span></span><br><span class="line">   <span class="keyword">uint16_t</span> status;                     <span class="comment">//!&lt; \brief An integer telling the status of the command. This value is</span></span><br><span class="line">                                        <span class="comment">//!&lt;        updated by the radio CPU during operation and may be read by the</span></span><br><span class="line">                                        <span class="comment">//!&lt;        system CPU at any time.</span></span><br><span class="line">   rfc_radioOp_t *pNextOp;              <span class="comment">//!&lt;        Pointer to the next operation to run after this operation is done</span></span><br><span class="line">   <span class="keyword">ratmr_t</span> startTime;                   <span class="comment">//!&lt;        Absolute or relative start time (depending on the value of &lt;code&gt;startTrigger&lt;/code&gt;)</span></span><br><span class="line">   <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">      <span class="keyword">uint8_t</span> triggerType:<span class="number">4</span>;            <span class="comment">//!&lt;        The type of trigger</span></span><br><span class="line">      <span class="keyword">uint8_t</span> bEnaCmd:<span class="number">1</span>;                <span class="comment">//!&lt; \brief 0: No alternative trigger command&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: CMD_TRIGGER can be used as an alternative trigger</span></span><br><span class="line">      <span class="keyword">uint8_t</span> triggerNo:<span class="number">2</span>;              <span class="comment">//!&lt;        The trigger number of the CMD_TRIGGER command that triggers this action</span></span><br><span class="line">      <span class="keyword">uint8_t</span> pastTrig:<span class="number">1</span>;               <span class="comment">//!&lt; \brief 0: A trigger in the past is never triggered, or for start of commands, give an error&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: A trigger in the past is triggered as soon as possible</span></span><br><span class="line">   &#125; startTrigger;                      <span class="comment">//!&lt;        Identification of the trigger that starts the operation</span></span><br><span class="line">   <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">      <span class="keyword">uint8_t</span> rule:<span class="number">4</span>;                   <span class="comment">//!&lt;        Condition for running next command: Rule for how to proceed</span></span><br><span class="line">      <span class="keyword">uint8_t</span> nSkip:<span class="number">4</span>;                  <span class="comment">//!&lt;        Number of skips if the rule involves skipping</span></span><br><span class="line">   &#125; condition;</span><br><span class="line">   <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">      <span class="keyword">uint8_t</span> bIncludePhyHdr:<span class="number">1</span>;         <span class="comment">//!&lt; \brief 0: Find PHY header automatically&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: Insert PHY header from the buffer</span></span><br><span class="line">      <span class="keyword">uint8_t</span> bIncludeCrc:<span class="number">1</span>;            <span class="comment">//!&lt; \brief 0: Append automatically calculated CRC&lt;br&gt;</span></span><br><span class="line">                                        <span class="comment">//!&lt;        1: Insert FCS (CRC) from the buffer</span></span><br><span class="line">      <span class="keyword">uint8_t</span> :<span class="number">1</span>;</span><br><span class="line">      <span class="keyword">uint8_t</span> payloadLenMsb:<span class="number">5</span>;          <span class="comment">//!&lt; \brief Most significant bits of payload length. Should only be non-zero to create long</span></span><br><span class="line">                                        <span class="comment">//!&lt;        non-standard packets for test purposes</span></span><br><span class="line">   &#125; txOpt;</span><br><span class="line">   <span class="keyword">uint8_t</span> payloadLen;                  <span class="comment">//!&lt;        Number of bytes in the payload</span></span><br><span class="line">   <span class="keyword">uint8_t</span>* pPayload;                   <span class="comment">//!&lt;        Pointer to payload buffer of size &lt;code&gt;payloadLen&lt;/code&gt;</span></span><br><span class="line">   <span class="keyword">ratmr_t</span> timeStamp;                   <span class="comment">//!&lt;        Time stamp of transmitted frame</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><h1 id="7-下一步"><a href="#7-下一步" class="headerlink" title="7. 下一步"></a>7. 下一步</h1><p>在代码分析中有两个东西直接忽略掉了，下一步需要补上。</p><ul><li>LPM 相关</li><li>ENERGEST相关</li></ul></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/Contiki/" rel="tag"># Contiki</a> <a href="/tags/RF/" rel="tag"># RF</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2016/10/25/161025-ContikiOlcdPost/" rel="next" title="Contiki OLCD移植"><i class="fa fa-chevron-left"></i> Contiki OLCD移植</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"> <a href="/2016/10/26/161026-Contiki-energest/" rel="prev" title="Contiki Energest">Contiki Energest<i class="fa fa-chevron-right"></i></a></div></div></footer></div></article><div class="post-spread"></div></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap"> 文章目录</li><li class="sidebar-nav-overview" data-target="site-overview"> 站点概览</li></ul><section class="site-overview sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="https://raw.githubusercontent.com/XuBovey/xubovey.github.io/source/blog_images/images/avatar.jpg" alt="xu.bovey"><p class="site-author-name" itemprop="name">xu.bovey</p><p class="site-description motion-element" itemprop="description">点点 - 滴滴</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">49</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">18</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">27</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"></div></section><section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-main函数中的RF相关代码"><span class="nav-number">1.</span> <span class="nav-text">1. main函数中的RF相关代码</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-set-rf-params函数"><span class="nav-number">2.</span> <span class="nav-text">2. set_rf_params函数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-netstack-init函数"><span class="nav-number">3.</span> <span class="nav-text">3 netstack_init函数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-ieee-mode-driver-init"><span class="nav-number">4.</span> <span class="nav-text">4 ieee_mode_driver.init</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-rf-core-process"><span class="nav-number">5.</span> <span class="nav-text">5. rf_core_process</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-自定义配置"><span class="nav-number">6.</span> <span class="nav-text">6. 自定义配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-1-CMD-IEEE-RX命令参数"><span class="nav-number">7.</span> <span class="nav-text">6.1 CMD_IEEE_RX命令参数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-CMD-IEEE-TX命令参数"><span class="nav-number">7.1.</span> <span class="nav-text">6.2 CMD_IEEE_TX命令参数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-下一步"><span class="nav-number">8.</span> <span class="nav-text">7. 下一步</span></a></li></ol></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2019</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">xu.bovey</span></div><div class="powered-by"> 由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div><div class="theme-info"> 主题 - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script></body></html>